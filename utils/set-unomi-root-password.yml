---
type: update
version: 0.1
name: Unomi - set root password
id: unomi-set-root-password
description:
  short: Unomi - set new root password

globals:
  new_password: ${settings.rootpwd}
  env_file: "/opt/unomi/unomi-$STACK_VERSION/bin/setenv"
  datatog_file: "/etc/datadog-agent/conf.d/jmx.d/conf.yaml"
  base_url_branch: ${settings.base_url_branch}
  base_url: "https://github.com/Jahia/paas_jelastic_unomi/raw/${globals.base_url_branch}"
  script_path: "/usr/local/bin/reset-unomi-root-password.py"

onInstall:
  - cmd [cp]: |-
      yum install python3
      wget -O ${globals.script_path} ${globals.base_url}/scripts/reset-unomi-root-password.py
      chmod u+x ${globals.script_path}
      ${globals.script_path} "${globals.new_password}" "${globals.env_file}" "${globals.datatog_file}"

settings:
  fields:
    - name: rootpwd
      type: string
      caption: New Unomi root password encoded in base64
      inputType: password
      required: true
    - name: base_url_branch
      type: string
      caption: base url branch
      default: master
      required: true
